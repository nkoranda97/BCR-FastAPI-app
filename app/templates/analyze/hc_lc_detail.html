{% extends 'analyze/base.html' %}

{% block head %}
{{ super() }}
{% endblock %}

{% block analyze_content %}
{% set hc_fasta = hc_fasta or '' %}
{% set lc_fasta = lc_fasta or '' %}

<!-- =====================================================================
     Paired Alignment Viewer page – cards now constrain width & scroll     
     ===================================================================== -->
<div class="container mx-auto max-w-screen-xl px-6 py-8 space-y-10">
  <div class="bg-white rounded-lg shadow-lg p-6 space-y-10">
    <!-- --------------------------------------------------------------- -->
    <!-- Header / project meta                                           -->
    <!-- --------------------------------------------------------------- -->
    <h1 class="text-2xl font-bold">HC/LC Gene Pair Details</h1>
    <div class="text-sm leading-6">
      {% if project %}
      <span class="font-semibold">Project:</span> {{ project.project_name }}<br>
      {% endif %}
      <span class="font-semibold">Heavy Chain (HC) Gene:</span> {{ hc_gene }}<br>
      <span class="font-semibold">Light Chain (LC) Gene:</span> {{ lc_gene }}
    </div>

    <!-- --------------------------------------------------------------- -->
    <!-- Heavy‑chain alignment card                                      -->
    <!-- --------------------------------------------------------------- -->
    <div class="rounded-lg shadow border border-slate-200 bg-white p-6 space-y-4 overflow-hidden">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Heavy Chain Amino-acid Alignment</h2>
        {% if hc_json and hc_json|length > 0 %}
        <a href="{{ url_for('analyze.download_fasta', project_id=project_id, hc_gene=hc_gene, lc_gene=lc_gene, chain_type='hc') }}"
           class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm font-medium"
           aria-label="Download Heavy-chain FASTA file">
          Download HC FASTA
        </a>
        {% endif %}
      </div>

      {% if hc_json and hc_json|length > 0 %}
      <div class="overflow-x-auto w-full border border-slate-200 rounded">
        <div id="msa-hc" data-seqs='{{ hc_json|tojson|safe }}' data-region-blocks='{{ hc_region_blocks|tojson|safe if hc_region_blocks else '' }}'></div>
      </div>
      {% else %}
      <p class="text-gray-500">No Heavy-chain alignment data available.</p>
      {% endif %}
    </div>

    <!-- --------------------------------------------------------------- -->
    <!-- Light‑chain alignment card                                      -->
    <!-- --------------------------------------------------------------- -->
    <div class="rounded-lg shadow border border-slate-200 bg-white p-6 space-y-4 overflow-hidden">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Light Chain Amino-acid Alignment</h2>
        {% if lc_json and lc_json|length > 0 %}
        <a href="{{ url_for('analyze.download_fasta', project_id=project_id, hc_gene=hc_gene, lc_gene=lc_gene, chain_type='lc') }}"
           class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors text-sm font-medium"
           aria-label="Download Light-chain FASTA file">
          Download LC FASTA
        </a>
        {% endif %}
      </div>

      {% if lc_json and lc_json|length > 0 %}
      <div class="overflow-x-auto w-full border border-slate-200 rounded">
        <div id="msa-lc" data-seqs='{{ lc_json|tojson|safe }}' data-region-blocks='{{ lc_region_blocks|tojson|safe if lc_region_blocks else '' }}'></div>
      </div>
      {% else %}
      <p class="text-gray-500">No Light-chain alignment data available.</p>
      {% endif %}
    </div>
  </div>
</div>

<!-- --------------------------------------------------------------- -->
<!-- External viewer script                                           -->
<!-- --------------------------------------------------------------- -->
<script src="/static/js/msa-viewer.js"></script>
{% endblock %}
